language: go

go:
  - "1.10"
  - master

sudo: false

matrix:
  include:
    - os: linux
      go: "1.9"
      sudo: required
      env: PRIMARY_CONFIG=true
    - os: osx
      osx_image: xcode9.3beta
      go: "1.9.2"

addons:
  apt:
    packages:
      - musl-tools

cache:
  directories:
    - $HOME/.glide

install:
  - mkdir -p "$GOPATH/bin"
  - curl https://glide.sh/get | sh
  - make deps-install
  - if [ "$PRIMARY_CONFIG" == "true" ];then make coverdeps-install; fi

script:
  - make build
  - if [ "$PRIMARY_CONFIG" != "true" ]; then make test-full; fi
  - make test-vet
  - if [ "$PRIMARY_CONFIG" == "true" ];then make image     ; fi
  - if [ "$PRIMARY_CONFIG" == "true" ];then make test-cover; fi

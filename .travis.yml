language: go

sudo: false

git:
  depth: 5

env:
  global:
    - TEST_DELAY_THREAD_START=10ms

stages:
  - test
  - image

jobs:
  include:

    - name: test
      os: linux
      go: 1.9
      script:
        - make build
        - make test-vet
        - make coverdeps-install
        - make test-cover

    - name: test
      os: linux
      go: "1.10"
      script:
        - make build
        - make test-vet
        - make test
        - make integrationdeps-install
        - make test-integration

    - name: test
      os: linux
      go: master
      script:
        - make build
        - make test-vet
        - make test
      if: type = cron

    - name: test
      os: osx
      osx_image: xcode9.3beta
      go: "1.9.2"
      script:
        - make build
        - make test-vet
        - make test
      if: type = cron

    - name: image
      os: linux
      go: "1.10"
      sudo: required
      script:
        - make image
      if: type = cron

cache:
  directories:
    - $HOME/.glide

install:
  - mkdir -p "$GOPATH/bin"
  - curl https://glide.sh/get | sh
  - make deps-install
